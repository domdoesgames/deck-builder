# Vite Configuration Contract

**Feature**: GitHub Pages Public Deployment  
**Component**: Build Configuration (Vite)  
**Created**: 2025-11-13

## Purpose

This contract defines the required Vite configuration for GitHub Pages deployment, ensuring all assets are built with the correct base path for repository-based hosting.

## Contracts

### C007: Base Path Configuration

**Contract**: The Vite configuration MUST set the `base` option to `/<repository-name>/` to match the GitHub Pages URL structure for repository deployments.

**Implementation**:
```typescript
// vite.config.ts
export default defineConfig({
  plugins: [react()],
  base: '/deck-builder/',  // GitHub Pages base path
})
```

**Validation**:
- `vite.config.ts` includes `base: '/deck-builder/'`
- Base path matches repository name exactly
- Base path ends with trailing slash

**Rationale**: GitHub Pages serves repository sites at `https://<username>.github.io/<repository>/`, requiring all asset paths to include the repository name prefix.

---

### C008: Build Output Integrity

**Contract**: The production build MUST generate all files in the `dist/` directory with asset paths correctly prefixed with the base path.

**Validation**:
- Run `npm run build`
- Inspect `dist/index.html` - script and link tags include base path (e.g., `/deck-builder/assets/...`)
- All JavaScript, CSS, and other assets reference base path
- No absolute paths without base path prefix

**Example Expected Output**:
```html
<script type="module" crossorigin src="/deck-builder/assets/index-[hash].js"></script>
<link rel="stylesheet" crossorigin href="/deck-builder/assets/index-[hash].css">
```

**Rationale**: Ensures assets load correctly when deployed to GitHub Pages sub-path.

---

### C009: Asset Reference Consistency

**Contract**: All asset references (JavaScript imports, CSS URLs, images) MUST use the configured base path, with no hardcoded absolute paths that bypass the base path.

**Validation**:
- Search build output for absolute paths starting with `/` (excluding base path)
- Verify all asset references include `/deck-builder/` prefix
- Test with local preview: `npx vite preview` serves at correct base path

**Rationale**: Prevents 404 errors on deployed site due to incorrect asset paths.

---

### C010: HTML Entry Point Correctness

**Contract**: The generated `dist/index.html` MUST load successfully when accessed via the GitHub Pages URL (`https://<username>.github.io/deck-builder/`), with all scripts and stylesheets loading without 404 errors.

**Validation**:
- After deployment, access public URL
- Open browser DevTools Network tab
- Verify all requests return HTTP 200 (no 404s)
- Application becomes interactive (JavaScript executes)

**Success Criteria**: SC-007 requires zero 404 errors on asset loading.

---

## Validation Checklist

**Pre-Build Validation**:
- [ ] `vite.config.ts` exists in repository root
- [ ] `base` configuration is set to `/deck-builder/`
- [ ] Configuration syntax is valid TypeScript
- [ ] No conflicting build configuration in `package.json`

**Post-Build Validation**:
- [ ] `npm run build` completes successfully
- [ ] `dist/index.html` contains base path in asset URLs
- [ ] All generated assets (JS, CSS) use correct base path
- [ ] Local preview works: `npx vite preview` at `/deck-builder/`
- [ ] Build output size is reasonable (~200-300KB total)

**Post-Deployment Validation**:
- [ ] Public URL loads index.html successfully
- [ ] Browser console shows zero 404 errors
- [ ] All scripts and stylesheets load and execute
- [ ] Application is fully functional on public URL

## Test Strategy

**Automated Validation**:
- Build step in CI/CD workflow validates build success
- Linter checks for hardcoded paths (if configured)

**Manual Validation**:
- Inspect `dist/index.html` after build
- Test local preview: `npx vite preview --port 4173`, navigate to `http://localhost:4173/deck-builder/`
- Test deployed site: Navigate to public URL, check browser console

## Error Handling

**Build Failures**: 
- Invalid `base` configuration → TypeScript compilation error or build failure
- Resolution: Fix `vite.config.ts` syntax

**404 Errors on Deployment**:
- Missing base path → Assets fail to load
- Resolution: Verify `base` configuration matches repository name exactly

**Preview Issues**:
- Wrong base path → Local preview doesn't work
- Resolution: Ensure base path is `/deck-builder/` with trailing slash

## Dependencies

- Vite 5.0.8 build tool
- `vite.config.ts` configuration file
- `dist/` output directory (generated by build)
- GitHub Pages hosting service

## Breaking Changes

**Configuration will break if**:
- Repository name changes (requires updating `base` path)
- Vite major version upgrade changes `base` behavior
- Deployment switches from repository to user/organization site (different URL structure)

**Recovery**: Update `base` path in `vite.config.ts` to match new repository name or deployment type.

## Notes

- **User/Organization Sites**: If deploying to `https://<username>.github.io/` (user site, not repository site), set `base: '/'` instead
- **Custom Domains**: If using custom domain, set `base: '/'` (custom domains serve at root)
- **Current Configuration**: Repository deployment requires `base: '/deck-builder/'`
